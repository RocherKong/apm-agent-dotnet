<?xml version="1.0" encoding="utf-8" ?>
<!--
*******************************
 Create By Rocher Kong 
 Date 2019-07-18 14:03
*******************************
-->
<SmartSqlMap Scope="Member"  xmlns="http://SmartSql.net/schemas/SmartSqlMap.xsd">
  <Statements>
    <Statement Id="QueryParams">
      <Where Min="1">
        <IsGreaterThan Prepend="And" Property="EnterpriseId" CompareValue="0">
          T.EnterpriseId=@EnterpriseId
        </IsGreaterThan>
      </Where>
    </Statement>

    <!--新增-->
    <Statement Id="Insert">
      INSERT INTO T_Member
      (LoginName
      ,NickName
      ,TrueName
      ,Avatar
      ,Password
      ,EMail
      ,Sex
      ,MobilePhone
      ,Status
      ,Type
      ,RegisterFrom
      ,LastLogOnTime
      ,IsDelete
      ,CreateTime
      ,ModifyTime
      ,Creator)
      VALUES
      (@LoginName
      ,@NickName
      ,@TrueName
      ,@Avatar
      ,@Password
      ,@EMail
      ,@Sex
      ,@MobilePhone
      ,@Status
      ,@Type
      ,@RegisterFrom
      ,@LastLogOnTime
      ,@IsDelete
      ,@CreateTime
      ,GETDATE()
      ,@Creator)
      ;Select Scope_Identity();
    </Statement>

    <!--删除-->
    <Statement Id="Delete">
      Update T_Member
      Set IsDelete=1
      Where Id=@Id
    </Statement>


    <!--更新-->
    <Statement Id="Update">
      UPDATE T_Member
      SET
      <Dynamic>
        ModifyTime = GETDATE()
        <IsProperty Prepend="," Property="LoginName">
          LoginName = @LoginName
        </IsProperty>
        <IsProperty Prepend="," Property="NickName">
          NickName = @NickName
        </IsProperty>
        <IsProperty Prepend="," Property="TrueName">
          TrueName = @TrueName
        </IsProperty>
        <IsProperty Prepend="," Property="Avatar">
          Avatar = @Avatar
        </IsProperty>
        <IsProperty Prepend="," Property="Password">
          Password = @Password
        </IsProperty>
        <IsProperty Prepend="," Property="EMail">
          EMail = @EMail
        </IsProperty>
        <IsProperty Prepend="," Property="Sex">
          Sex = @Sex
        </IsProperty>
        <IsProperty Prepend="," Property="MobilePhone">
          MobilePhone = @MobilePhone
        </IsProperty>
        <IsProperty Prepend="," Property="Status">
          Status = @Status
        </IsProperty>
        <IsProperty Prepend="," Property="Type">
          Type = @Type
        </IsProperty>
        <IsProperty Prepend="," Property="RegisterFrom">
          RegisterFrom = @RegisterFrom
        </IsProperty>
        <IsProperty Prepend="," Property="LastLogOnTime">
          LastLogOnTime = @LastLogOnTime
        </IsProperty>
        <IsProperty Prepend="," Property="IsDelete">
          IsDelete = @IsDelete
        </IsProperty>
        <IsProperty Prepend="," Property="CreateTime">
          CreateTime = @CreateTime
        </IsProperty>
        <IsProperty Prepend="," Property="Creator">
          Creator = @Creator
        </IsProperty>
      </Dynamic>
      Where Id=@Id
    </Statement>

    <!--获取数据列-->
    <Statement Id="Query">
      SELECT T.* From T_Member T With(NoLock)
      <Include RefId="QueryParams"/>
      Order By T.Id Desc
    </Statement>


    <!--获取分页数据-->
    <Statement Id="QueryByPage">
      Select TT.* From
      (Select ROW_NUMBER() Over(Order By T.Id Desc) Row_Index,T.* From T_Member T With(NoLock)
      <Include RefId="QueryParams"/>) TT
      Where TT.Row_Index Between ((@PageIndex-1)*@PageSize+1) And (@PageIndex*@PageSize)
    </Statement>

    <!--获取记录数-->
    <Statement Id="GetRecord">
      Select Count(1) From T_Member T With(NoLock)
      <Include RefId="QueryParams"/>
    </Statement>

    <!--获取表映射实体-->
    <Statement Id="GetEntity">
      Select Top 1 T.* From T_Member T With(NoLock)
      <Where Min="1">
        <IsNotEmpty Prepend="And" Property="Id">
          T.Id=@Id
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="MobilePhone">
          T.MobilePhone=@MobilePhone
        </IsNotEmpty>
        <IsGreaterThan Prepend="And" Property="Type" CompareValue="0">
          T.Type=@Type
        </IsGreaterThan>
      </Where>
    </Statement>

    <!--是否存在该记录-->
    <Statement Id="IsExist">
      Select Count(1) From T_Member T With(NoLock)
      <Where Min="1">
        <IsNotEmpty Prepend="And" Property="EMail">
          T.EMail=@EMail
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="LoginName">
          T.LoginName=@LoginName
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="LoginName">
          T.LoginName=@LoginName
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="MobilePhone">
          T.MobilePhone=@MobilePhone
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="Type">
          T.Type=@Type
        </IsNotEmpty>
        <IsNotEmpty Prepend="And" Property="HasStatus">
          <![CDATA[T.Status&@HasStatus=@HasStatus]]>
        </IsNotEmpty>
      </Where>
    </Statement>

  </Statements>
</SmartSqlMap>